Index: data/objects/objects.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- data/objects/objects.py	(revision 8c9cdb31f6ea23f7ea86afb5668c4947df8b26ee)
+++ data/objects/objects.py	(revision )
@@ -14,6 +14,7 @@
 metric = 'pr'
 
 # season-month dictionary for brazil
+seasons = ['w', 'd']
 data_dict = {'month': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
              'season': ['w', 'w', 'w', 'd', 'd',' d', 'd', 'd', 'd', 'w', 'w', 'w']}
 df_season = pd.DataFrame(data=data_dict)
@@ -35,7 +36,7 @@
 header_knmi_raw = ['Year', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
 
 
-# threshold value for zero precipitation NEED TO FINALISE WITH RALF
+# threshold value for zero precipitation
 pr_threshold = 1
 
 # gauges column names
@@ -56,10 +57,12 @@
 # column names for building metrics in tables
 r_names_month = ['station', 'elnino_metric', 'month', 'n', 'r_value', 'p_value']
 r_names_season = ['station', 'elnino_metric', 'season', 'n', 'r_value', 'p_value']
+r_names_year = ['station', 'elnino_metric', 'month', 'n', 'r_value', 'p_value']
 r_names_2 = ['station', 'threshold', 'slope', 'r_value', 'p_value']
 
 # treshold for number of days to drop to leave out a month
 threshold_drop_days = 5
+threshold_drop_months = 3
 
 # relative lengths of months
 day_months_long = [1, 3, 5, 7, 8, 10, 12]
Index: prog/scripts/weather_station_elnino_soi_correlate.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- prog/scripts/weather_station_elnino_soi_correlate.py	(revision 8c9cdb31f6ea23f7ea86afb5668c4947df8b26ee)
+++ prog/scripts/weather_station_elnino_soi_correlate.py	(revision )
@@ -16,6 +16,7 @@
 # output file for r values for each station
 df_master = pd.DataFrame(columns=r_names_month)
 df_season_master = pd.DataFrame(columns=r_names_season)
+df_year_master = pd.DataFrame(columns=r_names_year)
 for i in elninos:
 
     df_submaster = pd.DataFrame(columns=r_names_month)
@@ -41,6 +42,8 @@
         # remove duplicates
         data = data.drop_duplicates(subset=['month', 'year'], keep='first')
 
+        #######################################################################################################
+
         # load the chosen el nino/soi measure and correlate
         metric = pd.read_csv(os.path.join(knmi_elnino, 'iersst_' + i + '.txt'),
                              skiprows=76, header=None, sep='\s+')
@@ -52,22 +55,57 @@
         metric['year'] = round(metric['date'].apply(np.floor))
         metric['month'] = 1 + round(12 * (metric['date'] - metric['year']))
 
+        #######################################################################################################
+
         # merge data and el nino values
         dat_merged = pd.merge(data, metric, left_on=['year', 'month'], right_on=['year', 'month'])
-
         dat_merged = pd.merge(dat_merged, df_season, left_on=['month'], right_on=['month'])
 
         # sort by month and year column
         dat_merged.sort_values(['year', 'month'], ascending=[True, True], inplace=True)
 
-        print(dat_merged.head())
+        #######################################################################################################
 
         # calculate correlation value per season
+        for season in seasons:
 
+            # isolate season
+            dat_seasons = dat_merged[dat_merged.season == season]
+            metric = metric[metric.season == season]
 
-        # calculate correlation value of total rainfall with a particular month's values
-        # WORKING HERE
+            # filter missing data depending on length of month
+            for month in month_numbers:
+                if month in day_months_long:
+                    dat_seasons = dat_seasons.dropna(axis=0, thresh=threshold_drop_days)
+                if month in day_months_medium:
+                    dat_seasons = dat_seasons.dropna(axis=0, thresh=threshold_drop_days + 1)
+                if month in day_months_short:
+                    dat_seasons = dat_seasons.dropna(axis=0, thresh=threshold_drop_days + 3)
 
+            # sum rainfall per year per season and count the number of months in count
+            dat_grouped = dat_seasons.groupby(['season', 'year'])
+            dat_grouped = dat_grouped['total_pr'].agg(['sum', 'count'])
+
+            # drop if number of months is fewer than threshold
+            dat_grouped = dat_grouped[dat_grouped['count'] > threshold_drop_months]
+
+            print(dat_grouped.head())
+
+            # average el nino per year per season
+
+            dat_season_elnino = metric.groupby([])
+
+            # merge data and el nino values
+            dat_grouped = pd.merge(dat_grouped, metric, left_on=['year', 'month'], right_on=['year', 'month'])
+
+        #######################################################################################################
+
+#        # calculate correlation value of total rainfall with a particular month's values
+#        # WORKING HERE
+
+        #######################################################################################################
+
+#
 #         # calculate correlation value per month
 #         df = pd.DataFrame(columns=r_names_month)
 #         for k in month_numbers:
@@ -75,11 +113,6 @@
 #             # isolate month
 #             temp_df = dat_merged[dat_merged.month == k]
 #
-#             # drop months which have certain number of days missing and also the total precipitation
-#             day_months_long = [1, 3, 5, 7, 8, 10, 12]
-#             day_months_medium = [4, 6, 8, 11]
-#             day_months_short = [2]
-#
 #             # filter depending on length of month
 #             if k in day_months_long:
 #                 temp_df = temp_df.dropna(axis=0, thresh=threshold_drop_days)
@@ -115,10 +148,6 @@
 #
 #     df_master = df_master.append(df_submaster)
 #
-# # save correlation coefficients for all values
-# output_string = os.path.join(minas_knmi_climate_output,'minas_brazil', 'elnino_r_squared_values.csv')
-# df_master.sort_values(['r_value'], ascending=[True], inplace=True)
-# df_master.to_csv(output_string)
 #
 # # plot the correlation coefficients by for each station by month
 # g = ggplot(df_master, aes(x='month', y='r_value', color='station')) + \
@@ -133,4 +162,9 @@
 #     geom_abline(a=0,b=0, type='dashed')
 #
 # g.save(filename=os.path.join(minas_knmi_climate_output, 'minas_brazil', 'values_r_by_station_nino_metric_plot.pdf'))
-# h.save(filename=os.path.join(minas_knmi_climate_output, 'minas_brazil', 'values_r_by_station_nino_metric_sig_plot.pdf'))
\ No newline at end of file
+# h.save(filename=os.path.join(minas_knmi_climate_output, 'minas_brazil', 'values_r_by_station_nino_metric_sig_plot.pdf'))
+#
+# # save correlation coefficients for all values
+# output_string = os.path.join(minas_knmi_climate_output,'minas_brazil', 'elnino_r_squared_values.csv')
+# df_master.sort_values(['r_value'], ascending=[True], inplace=True)
+# df_master.to_csv(output_string)
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/workspace.xml	(revision 8c9cdb31f6ea23f7ea86afb5668c4947df8b26ee)
+++ .idea/workspace.xml	(revision )
@@ -5,7 +5,6 @@
       <change type="MODIFICATION" beforePath="$PROJECT_DIR$/.idea/workspace.xml" afterPath="$PROJECT_DIR$/.idea/workspace.xml" />
       <change type="MODIFICATION" beforePath="$PROJECT_DIR$/data/objects/objects.py" afterPath="$PROJECT_DIR$/data/objects/objects.py" />
       <change type="MODIFICATION" beforePath="$PROJECT_DIR$/prog/scripts/weather_station_elnino_soi_correlate.py" afterPath="$PROJECT_DIR$/prog/scripts/weather_station_elnino_soi_correlate.py" />
-      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/prog/scripts/weather_station_elnino_soi_correlate_detrend.py" afterPath="$PROJECT_DIR$/prog/scripts/weather_station_elnino_soi_correlate_detrend.py" />
     </list>
     <option name="EXCLUDED_CONVERTED_TO_IGNORED" value="true" />
     <option name="TRACKING_ENABLED" value="true" />
@@ -23,8 +22,8 @@
       <file leaf-file-name="data_tools.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/prog/functions/data/data_tools.py">
           <provider selected="true" editor-type-id="text-editor">
-            <state relative-caret-position="960">
-              <caret line="64" column="22" lean-forward="false" selection-start-line="64" selection-start-column="0" selection-end-line="65" selection-end-column="0" />
+            <state relative-caret-position="258">
+              <caret line="260" column="4" lean-forward="true" selection-start-line="260" selection-start-column="4" selection-end-line="260" selection-end-column="76" />
               <folding>
                 <element signature="e#0#34#0" expanded="true" />
               </folding>
@@ -35,8 +34,8 @@
       <file leaf-file-name="weather_station_elnino_soi_correlate.py" pinned="false" current-in-tab="true">
         <entry file="file://$PROJECT_DIR$/prog/scripts/weather_station_elnino_soi_correlate.py">
           <provider selected="true" editor-type-id="text-editor">
-            <state relative-caret-position="120">
-              <caret line="65" column="8" lean-forward="false" selection-start-line="65" selection-start-column="8" selection-end-line="65" selection-end-column="8" />
+            <state relative-caret-position="270">
+              <caret line="57" column="111" lean-forward="false" selection-start-line="57" selection-start-column="111" selection-end-line="57" selection-end-column="111" />
               <folding>
                 <element signature="e#0#9#0" expanded="true" />
               </folding>
@@ -47,8 +46,8 @@
       <file leaf-file-name="objects.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/data/objects/objects.py">
           <provider selected="true" editor-type-id="text-editor">
-            <state relative-caret-position="270">
-              <caret line="18" column="9" lean-forward="false" selection-start-line="18" selection-start-column="9" selection-end-line="18" selection-end-column="9" />
+            <state relative-caret-position="249">
+              <caret line="60" column="46" lean-forward="true" selection-start-line="60" selection-start-column="46" selection-end-line="60" selection-end-column="46" />
               <folding>
                 <element signature="e#0#44#0" expanded="true" />
               </folding>
@@ -78,7 +77,6 @@
   <component name="FindInProjectRecents">
     <findStrings>
       <find>metric</find>
-      <find>sum</find>
       <find>knmi_scenarios_absolute_change_monthly</find>
       <find>perc_del</find>
       <find>data_prep_knmi_scenarios_yearly</find>
@@ -97,6 +95,7 @@
       <find>recursive</find>
       <find>knmi_scenarios_scale_factors_monthly</find>
       <find>data_prep_knmi_scenarios_monthly</find>
+      <find>sum</find>
     </findStrings>
   </component>
   <component name="Git.Settings">
@@ -792,7 +791,14 @@
       <option name="project" value="LOCAL" />
       <updated>1516744770007</updated>
     </task>
-    <option name="localTasksCounter" value="38" />
+    <task id="LOCAL-00038" summary="second commit">
+      <created>1516831031680</created>
+      <option name="number" value="00038" />
+      <option name="presentableId" value="LOCAL-00038" />
+      <option name="project" value="LOCAL" />
+      <updated>1516831031680</updated>
+    </task>
+    <option name="localTasksCounter" value="39" />
     <servers />
   </component>
   <component name="ToolWindowManager">
@@ -803,12 +809,12 @@
       <window_info id="Event Log" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="true" content_ui="tabs" />
       <window_info id="Version Control" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.3297546" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
       <window_info id="Python Console" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32920793" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
-      <window_info id="Run" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.69036144" sideWeight="0.5" order="2" side_tool="false" content_ui="tabs" />
+      <window_info id="Run" active="true" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.4313253" sideWeight="0.5" order="2" side_tool="false" content_ui="tabs" />
       <window_info id="Terminal" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
       <window_info id="Project" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.38412017" sideWeight="0.5" order="0" side_tool="false" content_ui="combo" />
       <window_info id="R Packages" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="3" side_tool="false" content_ui="tabs" />
       <window_info id="R Graphics" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="3" side_tool="false" content_ui="tabs" />
-      <window_info id="Find" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32701063" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
+      <window_info id="Find" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32650602" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
       <window_info id="Structure" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
       <window_info id="Favorites" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="2" side_tool="true" content_ui="tabs" />
       <window_info id="Debug" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.39922178" sideWeight="0.5" order="3" side_tool="false" content_ui="tabs" />
@@ -1123,14 +1129,6 @@
         </state>
       </provider>
     </entry>
-    <entry file="file://$PROJECT_DIR$/prog/scripts/knmi_ensemble_mean_yearly_data_generate.py">
-      <provider selected="true" editor-type-id="text-editor">
-        <state relative-caret-position="420">
-          <caret line="34" column="0" lean-forward="true" selection-start-line="34" selection-start-column="0" selection-end-line="34" selection-end-column="0" />
-          <folding />
-        </state>
-      </provider>
-    </entry>
     <entry file="file://$PROJECT_DIR$/prog/scripts/knmi_ensemble_mean_monthly_plotting_perc_change.py">
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="300">
@@ -1207,28 +1205,36 @@
         </state>
       </provider>
     </entry>
-    <entry file="file://$PROJECT_DIR$/prog/functions/data/data_tools.py">
+    <entry file="file://$PROJECT_DIR$/prog/scripts/weather_station_knmi_pr_correlate.py">
       <provider selected="true" editor-type-id="text-editor">
-        <state relative-caret-position="960">
-          <caret line="64" column="22" lean-forward="false" selection-start-line="64" selection-start-column="0" selection-end-line="65" selection-end-column="0" />
-          <folding>
-            <element signature="e#0#34#0" expanded="true" />
-          </folding>
+        <state relative-caret-position="540">
+          <caret line="46" column="0" lean-forward="false" selection-start-line="46" selection-start-column="0" selection-end-line="46" selection-end-column="0" />
+          <folding />
         </state>
       </provider>
     </entry>
-    <entry file="file://$PROJECT_DIR$/prog/scripts/weather_station_knmi_pr_correlate.py">
+    <entry file="file://$PROJECT_DIR$/prog/scripts/knmi_ensemble_mean_yearly_data_generate.py">
       <provider selected="true" editor-type-id="text-editor">
-        <state relative-caret-position="540">
-          <caret line="46" column="0" lean-forward="false" selection-start-line="46" selection-start-column="0" selection-end-line="46" selection-end-column="0" />
+        <state relative-caret-position="420">
+          <caret line="34" column="0" lean-forward="true" selection-start-line="34" selection-start-column="0" selection-end-line="34" selection-end-column="0" />
           <folding />
         </state>
       </provider>
     </entry>
+    <entry file="file://$PROJECT_DIR$/prog/functions/data/data_tools.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="258">
+          <caret line="260" column="4" lean-forward="true" selection-start-line="260" selection-start-column="4" selection-end-line="260" selection-end-column="76" />
+          <folding>
+            <element signature="e#0#34#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
     <entry file="file://$PROJECT_DIR$/data/objects/objects.py">
       <provider selected="true" editor-type-id="text-editor">
-        <state relative-caret-position="270">
-          <caret line="18" column="9" lean-forward="false" selection-start-line="18" selection-start-column="9" selection-end-line="18" selection-end-column="9" />
+        <state relative-caret-position="249">
+          <caret line="60" column="46" lean-forward="true" selection-start-line="60" selection-start-column="46" selection-end-line="60" selection-end-column="46" />
           <folding>
             <element signature="e#0#44#0" expanded="true" />
           </folding>
@@ -1237,8 +1243,8 @@
     </entry>
     <entry file="file://$PROJECT_DIR$/prog/scripts/weather_station_elnino_soi_correlate.py">
       <provider selected="true" editor-type-id="text-editor">
-        <state relative-caret-position="120">
-          <caret line="65" column="8" lean-forward="false" selection-start-line="65" selection-start-column="8" selection-end-line="65" selection-end-column="8" />
+        <state relative-caret-position="270">
+          <caret line="57" column="111" lean-forward="false" selection-start-line="57" selection-start-column="111" selection-end-line="57" selection-end-column="111" />
           <folding>
             <element signature="e#0#9#0" expanded="true" />
           </folding>
